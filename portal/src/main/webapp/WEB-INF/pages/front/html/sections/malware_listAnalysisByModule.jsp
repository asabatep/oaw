<%@ include file="/common/taglibs.jsp" %> 
<%@page import="es.inteco.common.Constants"%>
<%@page import="java.util.HashMap"%>
<html:xhtml/>

	<bean:parameter id="idrastreo" name="idrastreo"/>
	<bean:parameter name="id" id="id"/>
	
	<jsp:useBean id="paramsCFC" class="java.util.HashMap" />
	<c:set target="${paramsCFC}" property="idrastreo" value="${idrastreo}" />
	<c:set target="${paramsCFC}" property="isCliente" value="true" />
	
	<jsp:useBean id="paramsVolver" class="java.util.HashMap" />
	<c:set target="${paramsVolver}" property="idrastreo" value="${idrastreo}" />
	<c:set target="${paramsVolver}" property="id" value="${id}" />

	<div id="migas">
		<p class="oculto"><bean:message key="ubicacion.usuario" /> </p>
		<p><html:link forward="indexAdmin"><bean:message key="migas.inicio" /></html:link> /
		<logic:present parameter="isCliente">
			<html:link forward="loadClientCrawlings"><bean:message key="migas.rastreos.cliente" /></html:link>
	 		/ <html:link forward="loadClientFulfilledCrawlings" name="paramsCFC"><bean:message key="migas.rastreos.realizados" /></html:link>
		</logic:present> 
		<logic:notPresent parameter="isCliente">
			<html:link forward="crawlingsMenu"><bean:message key="migas.rastreo" /></html:link>
		 	/ <html:link forward="verRastreosRealizados" paramId="<%= Constants.ID_RASTREO %>" paramName="idrastreo"><bean:message key="migas.rastreos.realizados" /></html:link>
		</logic:notPresent>
	 	/ <bean:message key="migas.malware.module.stadistics" /></p>
	</div>
	
	<div id="cuerpo">
		<div id="cIzq">&nbsp;</div>
		<div id="contenido">
			<div id="main">
				<h1 class="bulleth1"> <bean:message key="indice.rastreo.gestion.rastreos.realizados"/> </h1>
	
				<div id="cuerpoprincipal">
					
					<div id="container_menu_izq">
						<jsp:include page="menu.jsp"/>
					</div>
					
					<div id="container_der">
					
						<div id="cajaformularios">
							<h2><bean:message key="malware.module.stadistics"/></h2>
							<div class="detail">
							
								<jsp:useBean id="params" class="java.util.HashMap" />
								<c:set target="${params}" property="idrastreo" value="${idrastreo}" />
								<c:set target="${params}" property="id" value="${id}" />
							
								<div class="alignRight">
									<html:link forward="malwareModuleExportPDF" name="params"><img src="../images/icono_pdf.gif" alt="<bean:message key="indice.rastreo.exportar.pdf"/>" /></html:link>
									<html:link forward="malwareModuleExportPDF" name="params"><img src="../images/icono_regenerar_pdf.gif" alt="<bean:message key="indice.rastreo.exportar.pdf.regenerate"/>" /></html:link>
									<html:link forward="malwareModuleExportCSV" name="params"><img src="../images/csv.png" alt="<bean:message key="indice.rastreo.exportar.csv"/>" /></html:link>
								</div>
							
								<logic:iterate name="<%=Constants.MODULES %>" id="module">
									<table>
										<caption><bean:write name="module" property="name"/></caption>
										<thead>
											<tr>
												<th><bean:message key="search.results.hit"/></th>
												<th><bean:message key="search.results.occurrences"/></th>
												<th><bean:message key="malware.actions"/></th>
											</tr>
										</thead>
										<tbody>
											<logic:iterate name="module" property="subhits" id="submodule">
												<tr class="fixHeight">
													<td class="alignLeft"><strong><bean:write name="submodule" property="name"/></strong></td>
													<td><bean:write name="submodule" property="occurrences"/></td>
													<logic:empty name="submodule" property="onlyTerm">
														<td>&nbsp;</td>
													</logic:empty>
													<logic:notEmpty name="submodule" property="onlyTerm">
														<td>
															<c:set target="${params}" property="idter" value="${submodule.onlyTerm}" />
															<logic:notEqual name="submodule" property="occurrences" value="0">
																<ul class="lista_linea">
																	<li><html:link forward="malwareResultsByModuleDetail" name="params"><img src="../images/lupa2.gif" alt="<bean:message key="malware.img.ver.detalle.alt"/>" /></html:link></li>
																</ul>
															</logic:notEqual>
														</td>
													</logic:notEmpty>
												</tr>
												<logic:notEmpty name="submodule" property="terms">
													<logic:iterate name="submodule" property="terms" id="term">
														<c:set target="${params}" property="idter" value="${term.id}" />
														<tr class="fixHeight">
															<td class="alignCenter"><bean:write name="term" property="term"/></td>
															<td><bean:write name="term" property="occurrences"/></td>
															<td>
																<logic:notEqual name="submodule" property="occurrences" value="0">
																	<ul class="lista_linea">
																		<li><html:link forward="malwareResultsByModuleDetail" name="params"><img src="../images/lupa2.gif" alt="<bean:message key="malware.img.ver.detalle.alt"/>"/></html:link></li>
																	</ul>
																</logic:notEqual>
															</td>
														</tr>
													</logic:iterate>
												</logic:notEmpty>
											</logic:iterate>
										</tbody>
									</table>
								</logic:iterate>
							</div>
					     	<p id="pCenter"><html:link forward="verRastreosRealizados" styleClass="boton" name="paramsVolver"><bean:message key ="boton.volver" /> </html:link></p>
						</div><!-- fin cajaformularios -->
					</div>
				</div><!-- fin CUERPO PRINCIPAL -->
			</div>
		</div>	
	</div> 
