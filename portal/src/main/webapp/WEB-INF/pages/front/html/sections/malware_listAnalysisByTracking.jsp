<%@ include file="/common/taglibs.jsp" %> 

<%@page import="es.inteco.common.Constants"%>
<%@page import="java.util.HashMap"%>
<html:xhtml/>

<html:javascript formName="UrlSearchForm"/>

	<bean:parameter id="idrastreo" name="idrastreo"/>
	<bean:parameter id="id" name="id"/>
	
	<jsp:useBean id="paramsCC" class="java.util.HashMap" />
	<c:set target="${paramsCC}" property="idrastreo" value="${idrastreo}" />
	<c:set target="${paramsCC}" property="isCliente" value="true" />

	<div id="migas">
		<p class="oculto"><bean:message key="ubicacion.usuario" /> </p>
		<p><html:link forward="indexAdmin"><bean:message key="migas.inicio" /></html:link> /
		<logic:present parameter="isCliente">
			<html:link forward="loadClientCrawlings"><bean:message key="migas.rastreos.cliente" /></html:link>
	 		/ <html:link forward="loadClientFulfilledCrawlings" name="paramsCC"><bean:message key="migas.rastreos.realizados" /></html:link>
		</logic:present> 
		<logic:notPresent parameter="isCliente">
			<html:link forward="crawlingsMenu"><bean:message key="migas.rastreo" /></html:link>
		 	/ <html:link forward="verRastreosRealizados" paramId="<%= Constants.ID_RASTREO %>" paramName="idrastreo"><bean:message key="migas.rastreos.realizados" /></html:link>
		</logic:notPresent>
	 	/ <bean:message key="migas.malware.url.stadistics" /></p>
	</div>
	
	<div id="cuerpo">
		<div id="cIzq">&nbsp;</div>
		<div id="contenido">
			<div id="main">
				<h1 class="bulleth1"> <bean:message key="indice.rastreo.gestion.rastreos.realizados"/> </h1>
	
				<div id="cuerpoprincipal">
					
					<div id="container_menu_izq">
						<jsp:include page="menu.jsp"/>
					</div>
					
					<div id="container_der">
					
						<div id="cajaformularios">
						
							<html:form action="/secure/malwareUrlAction.do" styleClass="formulario" method="get" onsubmit="return validateUrlSearchForm(this)">
								<input type="hidden" name="<%=Constants.ACCION %>" value="<%= Constants.RESULTS_BY_URL %>"/>
								<input type="hidden" name="<%=Constants.ID_RASTREO %>" value="<bean:write name="<%= Constants.ID_RASTREO %>"/>"/>
								<input type="hidden" name="<%=Constants.ID %>" value="<bean:write name="<%= Constants.ID %>"/>"/>
								<fieldset>
									<jsp:include page="/common/crawler_messages.jsp" />
									
									<div class="formItem">
										<label for="url"><strong class="labelVisu"><bean:message key="malware.search.url" />: </strong></label>
										<html:text styleId="url" property="url" styleClass="texto"/>
									</div>
									
									<div class="formItem">
										<label for="date"><strong class="labelVisu"><bean:message key="malware.search.date" />: </strong></label>
										<html:text styleId="date" property="date" />
										<span id="calendar">
											<img src="../images/boton-calendario.gif" onclick="popUpCalendar(this, document.forms['UrlSearchForm'].elements['date'], 'dd/mm/yyyy')" alt="<bean:message key="malware.img.calendario.alt" />"/> 
										</span>
										<bean:message key="date.format"/>
									</div>
									
									<div class="formItem">
										<label for="suspicionLevel"><strong class="labelVisu"><bean:message key="malware.search.suspicion.level" />: </strong></label>
										<html:text styleId="suspicionLevel" property="suspicionLevel" />
									</div>
									
									<div class="formButton">
										<html:submit><bean:message key="malware.search.button" /></html:submit>
									</div>
								</fieldset>
							</html:form>
						
							<logic:notPresent name="<%=Constants.RESULTS_BY_URL %>">	
								<div class="notaInformativaExito">
									<p><bean:message key="indice.termino.vacio"/></p>
								</div>
							</logic:notPresent>
							<logic:present name="<%=Constants.RESULTS_BY_URL %>">
								<logic:empty name="<%=Constants.RESULTS_BY_URL %>">	
									<div class="notaInformativaExito">
										<p><bean:message key="indice.termino.vacio"/></p>
									</div>
								</logic:empty>
								<logic:notEmpty name="<%=Constants.RESULTS_BY_URL %>">
									<div class="pag">
										<table>
											<thead>
												<tr>
													<th><bean:message key="search.results.domain"/></th>
													<th><bean:message key="search.results.category"/></th>
													<th><bean:message key="search.results.suspicion.level"/></th>
													<th><bean:message key="search.results.rules"/></th>
													<th><bean:message key="search.results.false.alarm"/></th>
												</tr>
											</thead>
											<tbody>
												<logic:iterate id="result" name="<%=Constants.RESULTS_BY_URL %>">
													<jsp:useBean id="params" class="java.util.HashMap" />
													<c:set target="${params}" property="idrastreo" value="${idrastreo}" />
													<c:set target="${params}" property="id" value="${id}" />
													<c:set target="${params}" property="urlHash" value="${result.md5}" />
													<logic:present parameter="isCliente">
														<c:set target="${params}" property="isCliente" value="true" />
													</logic:present>
													<tr>
														<td><bean:write name="result" property="url"/></td>
														<td><bean:write name="result" property="category"/></td>
														<td><bean:write name="result" property="suspicionLevel"/></td>
														<td><html:link forward="showMalwareResultsUrlDetail" name="params"><bean:message key="malware.view.rules"/></html:link></td>
														<bean:define id="falseAlarmTitle">
															<bean:message key="malware.false.alarm.title">
																<jsp:attribute name="arg0">
																	<bean:write name="result" property="url"/>
																</jsp:attribute>
															</bean:message>
														</bean:define>
														<td>
															<ul class="lista_linea">
																<li><html:link forward="falseAlarm" name="params"><img src="../images/falsa_alarma.gif" alt="<%=falseAlarmTitle %>" /></html:link></li>
																<li><html:link forward="malwareExportCSV" name="params"><img src="../images/csv.png" alt="<bean:message key="indice.rastreo.exportar.csv"/>" /></html:link></li>
																<li><html:link forward="malwareExportPDF" name="params"><img src="../images/icono_pdf.gif" alt="<bean:message key="indice.rastreo.exportar.pdf"/>" /></html:link></li>
															</ul>
														</td>
														
													</tr>
												</logic:iterate>
											</tbody>
										</table>
										
										<jsp:include page="pagination.jsp" />
									</div>
									<div class="spacer"></div>
								</logic:notEmpty>
							</logic:present>
							<p id="pCenter"><html:link forward="verRastreosRealizados" styleClass="boton" paramId="<%= Constants.ID_RASTREO %>" paramName="idrastreo"> <bean:message key="boton.volver"/> </html:link></p>
						</div><!-- fin cajaformularios -->
					</div>
				</div><!-- fin CUERPO PRINCIPAL -->
			</div>
		</div>	
	</div> 
